---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Insert title of project here"
subtitle: "https://github.com/mullja21/Mullens_Chang_Jenkins_872_EDA_Final.git"
author: "Irene Chang, Susanna Jenkins, and Jordan Mullens"
fontsize: 12pt
mainfont: Times New Roman

---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory
getwd()
setwd("/home/guest/Mullens_Chang_Jenkins_Final")

#install package
#install.packages("janitor")

# Load your packages
library(tidyverse)
library(agricolae)
library(ggplot2)
library(lubridate)
library(janitor)

# Set your ggplot theme
library(ggthemes)
our_theme <- theme_base() +
  theme(
    line = element_line(
      color= 'black',
      linewidth = 2),
    legend.background = element_rect(
      color = "lightgrey",
      fill = "lightgrey"),
    legend.title = element_text (
      color = "blue"))
theme_set(our_theme)


# Load your datasets
RDD.raw <- read.csv("./Public_RDD_Spending_All_Countries.csv")

```


# Rationale and Research Questions
Question 1: Was public investment in lower carbon energy RD&D significant during 
the Obama administration?


\newpage

# Dataset Information
The dataset utilized in this analysis was downloaded from International Energy 
Agency. The IEA's Energy Technology RD&D (Research, Development, & Demonstration) 
Budgets database provides spending information by energy technology in IEA 
countries from 1974 to 2022. Data is collected from central or federal government 
budgets and state-owned companies. Spending categories encompass renewables, 
nuclear power, fossil fuels, hydrogen, fuel cells, and energy efficiency.


\newpage

# Exploration of Raw Data 

```{r dataset info}
#checking the original data set dimensions before wrangling. View dimensions, column names, variable type, and head of each column.

dim(RDD.raw)
summary(RDD.raw)


```

# Data Wrangling
Downloaded the Energy Technology RD&D (Research, Development, & Demonstration) Budgets. After importing the data to GitHub and Rstudio, the raw dataset was wrangled to suit our analysis. A new data frame was created by extracting the desired years (1985-2015), currency (USD 2021 prices and exchange rates), and economic indications (Total, Fossil Fuels, and Unallocated) for each country. A variable for year-over-year percentage (YoY) difference was created to normalize all comparisons. 

```{r dataset wrangling}
#create new data frame, change column names
RDD.newcolnames <- RDD.raw %>%
  row_to_names(row_number = 1)

#The column names were imported improperly. The first row contains the correct column names, so we used the janitor package since they have a function that will replace the column names with the first row.


RDD.countries <-
  filter(RDD.newcolnames,
         Country == "Germany" | Country == "United States",
         Currency == "USD (2021 prices and exchange rates)") %>%
  rename("Economic.Indicators" = "Economic Indicators")


RDD.final <- RDD.countries %>%
  filter(Economic.Indicators == "Total Budget" | Economic.Indicators == "Unallocated " | Economic.Indicators == "Fossil fuels") %>%
  select("Country", "Currency", "Economic.Indicators", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015")

RDD.transpose <- data.frame(t(RDD.final))

#In our final data frame, we want each year to have its own row; however, in the original dataset, each year was a column. We transposed it.

colnames(RDD.transpose) <- c("Germany.FossilFuels", "Germany.Unallocated", "Germany.TotalBudget", "US.FossilFuels", "US.Unallocated", "US.TotalBudget")

RDD.transpose.rows <- RDD.transpose[!(row.names(RDD.transpose) %in% c("Country", "Currency", "Economic.Indicators")),]

 
RDD.transpose.rows <- RDD.transpose.rows %>%
  mutate_at(1:6, as.numeric)

#creating frame for US Data
RDD.US <- data.frame(Year=c("1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015"), 
                     Fossil.Fuel= RDD.transpose.rows$US.FossilFuels,
                     Unallocated= RDD.transpose.rows$US.Unallocated,
                     Total.Budget= RDD.transpose.rows$US.TotalBudget) %>%
  mutate(Low.Carbon.Energy = Total.Budget-Fossil.Fuel-Unallocated) %>%
  mutate(Percent.Change = ((Low.Carbon.Energy -
                              lag(Low.Carbon.Energy))/lag(Low.Carbon.Energy))*100) %>%
  mutate(Country = "US")


#creating frame for Germany Data
RDD.Germany <- data.frame(Year=c("1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015"),
                          Fossil.Fuel= RDD.transpose.rows$Germany.FossilFuels,
                          Unallocated= RDD.transpose.rows$Germany.Unallocated,
                          Total.Budget= RDD.transpose.rows$Germany.TotalBudget) %>%
  mutate(Low.Carbon.Energy = Total.Budget-Fossil.Fuel-Unallocated) %>%
  mutate(Percent.Change = ((Low.Carbon.Energy -
                              lag(Low.Carbon.Energy))/lag(Low.Carbon.Energy))*100) %>%
  mutate(Country = "Germany")

```


\newpage

# Analysis
Our analysis of this dataset focuses on comparing the mean investment YoY difference of the Pre-Obama era and the mean investment YoY difference of the Obama era. However, we need to ensure any changes in investment is unique to the Obama administration and not occurring globally. Therefore, we will also utilize t-tests to compare US investments to Germany's within the same time period.

```{r visualizing the US data}
#Adding date column to US data frame and transforming it into date object. Also adding a column to denote pre or Obama era
RDD.US.Eras <- RDD.US %>%
  mutate(Date = ymd(paste0(RDD.US$Year, "-01-01"))) %>%
  mutate(Era = ifelse(Year <= 2008, "Pre", "Obama"))

#plotting the pre-Obama data
RDD.US.Eras.plot <- RDD.US.Eras %>%
  ggplot(
         aes(x= Date,
             y= Percent.Change,
             color= Era)) + 
  geom_line() +
  geom_point() +
  geom_smooth(data = subset(RDD.US.Eras, Era == "Pre"), method = "lm", se=FALSE, color= "darkolivegreen3") +
  geom_smooth(data = subset(RDD.US.Eras, Era == "Obama"), method = "lm", se=FALSE, color= "dodgerblue3") +
  labs(title = "Year-over-Year Percent Change in Public \n Low-Carbon Energy RD&D Spending: U.S.",
       y="YoY Percent Change",
       x="Year") + 
  scale_color_manual(values = c("darkblue", "darkgreen")) +
  scale_x_date(date_breaks = "2 years", date_labels = "%Y") +
  our_theme +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
  
print(RDD.US.Eras.plot)

```




```{r visualizing the US and Germany data together}
#creating one data frame for US and Germany data
US.and.Germany.RDD <- rbind(RDD.Germany, RDD.US)

#Adding Date column and formatting so that column is transformed to date class
US.and.Germany.RDD$Date <- c(ymd(paste0(US.and.Germany.RDD$Year, "-01-01")))


#plotting the data
US.Germany.RDD.plot <- ggplot(US.and.Germany.RDD,
                              aes(x = Date,
                                  y = Percent.Change, 
                                  color = Country)) + 
  geom_line() +
  geom_point() +
  geom_smooth(data = subset(US.and.Germany.RDD, Country == "Germany"), method = "lm", se=FALSE, color= "tomato2") +
  geom_smooth(data = subset(RDD.US.Eras, Country == "US"), method = "lm", se=FALSE, color= "dodgerblue3") +
  scale_color_manual(values = c("tomato3", "darkblue")) +
  labs(title = "YoY Change in Public Low-Carbon \n Energy RD&D Spending: US vs. Germany",
       y="Year-over-Year Percent Change",
       x="Year") + 
  scale_x_date(date_breaks = "2 years", date_labels = "%Y") +
  our_theme +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
  
print(US.Germany.RDD.plot)

```





```{r conducting 3 ttests}

# T-test #1) U.S. Public Low-Carbon Energy RD&D Spending: Pre-Obama (1985-2008) vs. during Obama Administration (2009-2015)

        #Run  two-sample T-test on US RDD "Eras" data to determine if = mean YoY change in investment is the same or different before vs. during Obama admin
        ##hypothesis (?????) == change in mean YoY investment is significant during Obama administration

US.Pre.v.Post.Obama.ttest <- t.test(RDD.US.Eras$Percent.Change ~ 
                                      RDD.US.Eras$Era)

US.Pre.v.Post.Obama.ttest

      #The p-value is 0.5771 which is greater than 0.05 so THIS MEANS WE ACCEPT OUR NULL HYPOTHESIS? THAT MEANS THAT THE YOY CHANGE IN SPENDING WAS NOT (??) SIGNIFICANTLY DIFFERENT BTW THE PRE-OBAMA ERA AND THE POST-OBAMA ERA?? 

#---------------------------
  
# T-test #2) Pre-Obama Public Low-Carbon RD&D Spending (1985-2008): U.S. vs Germany 

Pre.2009.US.Germany.RDD <- filter(US.and.Germany.RDD, Year %in% c(1985:2008))
  
Pre.2009.US.Germany.ttest <- t.test(Pre.2009.US.Germany.RDD$Percent.Change ~ 
                                      Pre.2009.US.Germany.RDD$Country)

Pre.2009.US.Germany.ttest

      ##Hypothesis is that, prior to Obama's inauguration (in the period spanning 1985-2008), the mean YoY change in public low-carbon RDD spending in the United States is not statistically distinct from the mean YoY change in Germany  
    
      ##i'm pretty sure ^ this hypothesis would mean that our null hypothesis is: prior to obama admin, the mean YoY change in public low-carbon RDD spending in the United States IS statistically distinct from germany  
    
      #The p-value is 0.5113 which is greater than 0.05 so THIS MEANS WE ACCEPT OUR NULL HYPOTHESIS? THAT MEANS THAT THE YOY CHANGE IN SPENDING WAS SIGNIFICANTLY DIFFERENT BTW US AND GERMANY PRIOR TO OBAMA PRESIDENCY
    
      #NOTES FROM GOOGLE RE: NULL: If the p-value is below your threshold of significance (typically p < 0.05), then you can reject the null hypothesis, but this does not necessarily mean that your alternative hypothesis is true.

#------------------------------
  
# T-test #3) Obama-era Public Low-carbon RD&D Spending (2009-2015): United States vs. Germany

Post.2009.US.Germany.RDD <- filter(US.and.Germany.RDD, Year %in% c(2008:2015))
  
Post.2009.US.Germany.ttest <- t.test(Post.2009.US.Germany.RDD$Percent.Change ~ 
                                      Post.2009.US.Germany.RDD$Country)

Post.2009.US.Germany.ttest
  
        ##Hypothesis is that, in the time period after Obama's inauguration (2008-2015), the mean YoY change in public low-carbon RDD spending in the United States is statistically distinct from the mean YoY change in Germany  
      
        #The p-value is 0.9138 which is greater than 0.05 so DOES THIS MEAN WE ACCEPT OR REJECT OUR NULL HYPOTHESIS? WHAT DOES THE TTEST SAY ABOUT THE DIFFERENCE IN MEANS BTW THE TWO COUNTRIES? i think the null hypothesis is opposite of our hypothesis (in this case, that would be that the mean YoY change in public investment in US during obama admin isn't statistically distinct from germany)

```



## Question 1: <insert specific question here and add additional subsections for additional questions below, if needed>

## Question 2: 




\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
