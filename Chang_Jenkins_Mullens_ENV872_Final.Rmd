---
title: "Insert title of project here"
author: "Irene Chang, Susanna Jenkins, and Jordan Mullens"
output:
  html_document:
    df_print: paged
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
subtitle: https://github.com/mullja21/Mullens_Chang_Jenkins_872_EDA_Final.git
geometry: margin=2.54cm
fontsize: 12pt
mainfont: Times New Roman
editor_options:
  markdown:
    wrap: 72
---

```{=tex}
\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage
```
```{r setup, include=FALSE}
# Set your working directory
getwd()
setwd("/home/guest/Mullens_Chang_Jenkins_Final")

#install package
#install.packages("janitor")

# Load your packages
library(tidyverse)
library(agricolae)
library(ggplot2)
library(lubridate)
library(janitor)

# Set your ggplot theme
library(ggthemes)
our_theme <- theme_base() +
  theme(
    line = element_line(
      color= 'black',
      linewidth = 2),
    legend.background = element_rect(
      color = "ivory2",
      fill = "ivory2"),
    legend.title = element_text (
      color = "navy"))
theme_set(our_theme)


# Load your datasets
RDD.raw <- read.csv("./Raw_Data/Public_RDD_Spending_All_Countries.csv")

```

# Rationale and Research Questions

Question 1: Was the year-over-year change in public investment in
lower-carbon energy RD&D significant during the Obama administration?

\newpage

# Dataset Information

The dataset utilized in this analysis was downloaded from International
Energy Agency. The IEA's Energy Technology RD&D (Research, Development,
& Demonstration) Budgets database provides spending information by
energy technology in IEA countries from 1974 to 2022. Data is collected
from central or federal government budgets and state-owned companies.
Spending categories encompass renewables, nuclear power, fossil fuels,
hydrogen, fuel cells, and energy efficiency.

\newpage

# Data Wrangling

Downloaded the Energy Technology RD&D (Research, Development, &
Demonstration) Budgets. After importing the data to GitHub and Rstudio,
the raw dataset was wrangled to suit our analysis. A new data frame was
created by extracting the desired years (1985-2015), currency (USD 2021
prices and exchange rates), and economic indications (Total, Fossil
Fuels, and Unallocated) for each country. A variable for year-over-year
percentage (YoY) difference was created to normalize all comparisons.

```{r dataset wrangling}
#create new data frame, change column names
RDD.newcolnames <- RDD.raw %>%
  row_to_names(row_number = 1)

#The column names were imported improperly. The first row contains the correct 
#column names, so we used the janitor package since they have a function that 
#will replace the column names with the first row.


RDD.countries <-
  filter(RDD.newcolnames,
         Country == "Germany" | Country == "United States",
         Currency == "USD (2021 prices and exchange rates)") %>%
  rename("Economic.Indicators" = "Economic Indicators")


RDD.final <- RDD.countries %>%
  filter(Economic.Indicators == "Total Budget" | Economic.Indicators == "Unallocated " | Economic.Indicators == "Fossil fuels") %>%
  select("Country", "Currency", "Economic.Indicators", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015")

RDD.transpose <- data.frame(t(RDD.final))

#In our final data frame, we want each year to have its own row; however, 
#in the original dataset, each year was a column. We transposed it.

colnames(RDD.transpose) <- c("Germany.FossilFuels", "Germany.Unallocated", "Germany.TotalBudget", "US.FossilFuels", "US.Unallocated", "US.TotalBudget")

RDD.transpose.rows <- RDD.transpose[!(row.names(RDD.transpose) %in% c("Country", "Currency", "Economic.Indicators")),]

 
RDD.transpose.rows <- RDD.transpose.rows %>%
  mutate_at(1:6, as.numeric)

#creating frame for US Data
RDD.US <- data.frame(Year=c("1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015"), 
                     Fossil.Fuel= RDD.transpose.rows$US.FossilFuels,
                     Unallocated= RDD.transpose.rows$US.Unallocated,
                     Total.Budget= RDD.transpose.rows$US.TotalBudget) %>%
  mutate(Low.Carbon.Energy = c(Total.Budget-Fossil.Fuel-Unallocated)) %>%
  mutate(Percent.Change = ((Low.Carbon.Energy -
                              lag(Low.Carbon.Energy))/lag(Low.Carbon.Energy))*100) %>%
  mutate(Country = "US")


#creating frame for Germany Data
RDD.Germany <- data.frame(Year=c("1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015"),
                          Fossil.Fuel= RDD.transpose.rows$Germany.FossilFuels,
                          Unallocated= RDD.transpose.rows$Germany.Unallocated,
                          Total.Budget= RDD.transpose.rows$Germany.TotalBudget) %>%
  mutate(Low.Carbon.Energy = Total.Budget-Fossil.Fuel-Unallocated) %>%
  mutate(Percent.Change = ((Low.Carbon.Energy -
                              lag(Low.Carbon.Energy))/lag(Low.Carbon.Energy))*100) %>%
  mutate(Country = "Germany")

```

```{r cleaning up data set for exploratory phase and analysis}
#Adding date column to US data frame and transforming it into date object. Also 
#adding a column to denote pre or Obama era for graphing.
RDD.US.Eras <- RDD.US %>%
  mutate(Date = ymd(paste0(RDD.US$Year, "-01-01"))) %>%
  mutate(Era = ifelse(Year <= 2008, "Pre", "Obama"))

#creating one data frame for US and Germany data
US.and.Germany.RDD <- rbind(RDD.Germany, RDD.US)

#Adding Date column to US and Germany dataframe. Formatting so that column is 
#transformed to date class

US.and.Germany.RDD <- US.and.Germany.RDD %>%
  mutate(Date = ymd(paste0(US.and.Germany.RDD$Year, "-01-01"))) %>%
  mutate(Era = ifelse(Year <= 2008, "Pre", "Obama"))

```

```{r saving processed data}
#file for Us and Germany
write.csv(US.and.Germany.RDD, row.names = FALSE, file = "./Processed_Data/US.and.Germany.RDD.csv")

#File for US alone with eras
write.csv(RDD.US.Eras, row.names = FALSE, file = "./Processed_Data/US.Eras.RDD.csv")

```

\newpage

# Exploratory Analysis

```{r Exploring dimensions of the wrangled data set}

#US Data Set
dim(RDD.US)
colnames(RDD.US)
head(RDD.US)

#US and Germany

```


```{r calculating the summary statistics for US and Germany}

Germ.summary <- US.and.Germany.RDD %>%
  filter(Country== "Germany") %>%
  summary()
print(Germ.summary)

US.Pre.summary <- US.and.Germany.RDD %>%
  filter(Country== "US") %>%
  filter(Era== "Pre") %>%
  summary()
print(US.Pre.summary)

US.Obama.summary <- US.and.Germany.RDD %>%
  filter(Country== "US") %>%
  filter(Era== "Obama") %>%
  summary()
print(US.Obama.summary)

```



```{r}
# Create the combined bar plot
RDD.US.Eras.Bar.plot <- ggplot(RDD.US.Eras, aes(x = Year)) +
  geom_bar(aes(y = Total.Budget, fill = "Total.budget"), stat= "identity", position = "identity") +
  geom_bar(aes(y = Low.Carbon.Energy, fill = "Low.Carbon"), stat= "identity", position = "identity") +
  geom_bar(aes(y = Fossil.Fuel, fill = "Fossil.Fuels"), stat= "identity", position = "identity") +
  scale_fill_manual(values = c("Fossil.Fuels" = "midnightblue", "Low.Carbon" = "darkolivegreen3", "Total.budget" = "sienna3")) +
  labs(fill = "Budget Portion")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(title = "Proportion of RDD Spending",
       y="Amount in USD (2021 \n Pricess and Exchange Rates)",
       x="Year")
print(RDD.US.Eras.Bar.plot)


#US Line Plot
RDD.US.Eras.Line.plot <- ggplot(RDD.US.Eras, aes(x = Date)) +
  geom_line(aes(y = Total.Budget, color= "Total.budget")) +
  geom_line(aes(y = Fossil.Fuel, color= "Fossil.Fuels")) +
  geom_line(aes(y = Low.Carbon.Energy, color= "Low.Carbon")) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  scale_color_manual(name = "Proportion of \n RDD Spending", values= c(
    "Fossil.Fuels" = "midnightblue", 
    "Low.Carbon" = "darkolivegreen3", 
    "Total.budget" = "sienna3")) +
  scale_x_date(date_breaks = "3 years", date_labels = "%Y") +
  labs(title = "Proportion of \n United States RDD \n Spending 1985-2015",
       y="Amount in USD (2021 \n Pricess and Exchange Rates)",
       x="Year",
       color= "Legend Title")

print(RDD.US.Eras.Line.plot)


# Germ and US Line Plot
US.Germ.total.plot <- ggplot(US.and.Germany.RDD,
                              aes(x = Date,
                                  y = Total.Budget, 
                                  color = Country)) + 
  geom_line(size= 0.9) +
  ylim(0, 12500) +
  scale_color_manual(values = c("tomato3", "darkblue")) +
  labs(title = "Total RDD Spending 1985-2015",
       y="Amount in USD (2021 \n Pricess and Exchange Rates)",
       x="Year",
       color= "Legend Title")

print(US.Germ.total.plot)


#Fossil Fuel Germ and US Line Plot
US.Germ.fossil.plot <- ggplot(US.and.Germany.RDD,
                              aes(x = Date,
                                  y = Fossil.Fuel, 
                                  color = Country)) + 
  geom_line(size= 0.9) +
  ylim(0, 12500) +
  scale_color_manual(values = c("tomato3", "darkblue")) +
  labs(title = "Fossil Fuel RDD Spending 1985-2015",
       y="Amount in USD (2021 \n Pricess and Exchange Rates)",
       x="Year",
       color= "Legend Title")

print(US.Germ.fossil.plot)

#Low Carbon Germ and US Line Plot
US.Germ.lowC.plot <- ggplot(US.and.Germany.RDD,
                              aes(x = Date,
                                  y = Low.Carbon.Energy, 
                                  color = Country)) + 
  geom_line(size= 0.9) +
  ylim(0, 12500) +
  scale_color_manual(values = c("tomato3", "darkblue")) +
  labs(title = "Low Carbon RDD Spending 1985-2015",
       y="Amount in USD (2021 \n Pricess and Exchange Rates)",
       x="Year",
       color= "Legend Title")

print(US.Germ.lowC.plot)


#Creating a cowplot
library(cowplot)

legend_cow <- get_legend(
  US.Germ.lowC.plot + 
  guides(color = guide_legend(nrow = 1)) +
  theme(legend.position = "right"))


#Constructing the cowplot. NEED HELP FORMATTING SO THAT GRAPHS ARE VERTICAL
US.Germ.cowplot <- plot_grid(
  US.Germ.total.plot + theme(legend.position="none"),
  US.Germ.fossil.plot + theme(legend.position="none"),
  US.Germ.lowC.plot + theme(legend.position="none"),
  legend_cow
  )
print(US.Germ.cowplot)



# Create the US and Germ Total bar plot
US.Germ.total.Bar.plot <- ggplot(US.and.Germany.RDD, aes(x = Year, y= Total.Budget, fill= Country)) +
  geom_bar(stat= "identity", position = "stack") +
  geom_bar(stat= "identity", position = "stack") +
  scale_fill_manual(values = c("tomato3", "darkblue")) +
  ylim(0, 15000) +
  labs(fill = "Country")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(title = "Proportion of RDD Spending",
       y="Amount in USD (2021 \n Pricess and Exchange Rates)",
       x="Year")
print(RDD.US.Eras.Bar.plot)

# Create the US and Germ fossil fuel bar plot
US.Germ.Fossil.fuel.Bar.plot <- ggplot(US.and.Germany.RDD, aes(x = Year, y= Fossil.Fuel, fill= Country)) +
  geom_bar(stat= "identity", position = "stack") +
  geom_bar(stat= "identity", position = "stack") +
  scale_fill_manual(values = c("tomato3", "darkblue")) +
  ylim(0, 5000) +
  labs(fill = "Country")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(title = "Proportion of RDD Spending",
       y="Amount in USD (2021 \n Pricess and Exchange Rates)",
       x="Year")
print(US.Germ.Fossil.fuel.Bar.plot)

# Create the US and Germ fossil fuel bar plot
US.Germ.low.carbon.Bar.plot <- ggplot(US.and.Germany.RDD, aes(x = Year, y= Low.Carbon.Energy, fill= Country)) +
  geom_bar(stat= "identity", position = "stack") +
  geom_bar(stat= "identity", position = "stack") +
  scale_fill_manual(values = c("tomato3", "darkblue")) +
  ylim(0, 11000) +
  labs(fill = "Country")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(title = "Low Carbon RDD",
       y="Amount in USD (2021 \n Pricess and Exchange Rates)",
       x="Year")
print(US.Germ.low.carbon.Bar.plot)

```

\newpage

# Analysis

Our analysis of this dataset focuses on comparing the mean investment
YoY difference of the Pre-Obama era and the mean investment YoY
difference of the Obama era. However, we need to ensure any changes in
investment is unique to the Obama administration and not occurring
globally. Therefore, we will also utilize t-tests to compare US
investments to Germany's within the same time period.

```{r visualizing the US data, fig.cap= "US Year over Year RDD Spending 1985 to 2015"}
#plotting the pre-Obama data
RDD.US.Eras.plot <- RDD.US.Eras %>%
  ggplot(
         aes(x= Date,
             y= Percent.Change,
             color= Era)) + 
  geom_line() +
  geom_point() +
  geom_smooth(data = subset(RDD.US.Eras, Era == "Pre"), method = "lm", se=FALSE, color= "darkolivegreen4") +
  geom_smooth(data = subset(RDD.US.Eras, Era == "Obama"), method = "lm", se=FALSE, color= "dodgerblue3") +
  labs(title = "Year-over-Year Percent Change in Public \n Low-Carbon Energy RD&D \n Spending: U.S.",
       y="YoY Percent Change",
       x="Year") + 
  scale_color_manual(values = c("darkblue", "darkgreen")) +
  scale_x_date(date_breaks = "2 years", date_labels = "%Y") +
  our_theme +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
  
print(RDD.US.Eras.plot)

```

```{r visualizing the US and Germany data together, fig.cap= "US and Germany Year over Year RDD Spending 1985 to 2015"}
#plotting the data
US.Germany.RDD.plot <- ggplot(US.and.Germany.RDD,
                              aes(x = Date,
                                  y = Percent.Change, 
                                  color = Country)) + 
  geom_line() +
  geom_point() +
  geom_smooth(data = subset(US.and.Germany.RDD, Country == "Germany"), method = "lm", se=FALSE, color= "tomato2") +
  geom_smooth(data = subset(RDD.US.Eras, Country == "US"), method = "lm", se=FALSE, color= "dodgerblue3") +
  scale_color_manual(values = c("tomato3", "darkblue")) +
  labs(title = "YoY Change in Public Low-Carbon \n Energy RD&D Spending: \n US vs. Germany",
       y="Year-over-Year Percent Change",
       x="Year") + 
  scale_x_date(date_breaks = "2 years", date_labels = "%Y") +
  our_theme +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
  
print(US.Germany.RDD.plot)

```

```{r conducting 3 ttests}

# T-test #1) U.S. Public Low-Carbon Energy RD&D Spending: Pre-Obama (1985-2008) vs. during Obama Administration (2009-2015)

        #Alternative hypothesis == YoY change in public spending on lower-carbon energy RD&D is significant during Obama administration

        #Run two-sample T-test on US RDD "Eras" data to determine if mean YoY change in investment is the same or different before vs. during Obama admin

US.Pre.v.Post.Obama.ttest <- t.test(RDD.US.Eras$Percent.Change ~ 
                                      RDD.US.Eras$Era)

US.Pre.v.Post.Obama.ttest

         #The p-value is 0.5771 which is greater than 0.05 so we must accept our null hypothesis. Therefore, mean year-over-year change in public low-carbon RD&D spending during the Obama presidency (2009-2015) was not statistically distinct from the Pre-Obama era (1985-2008) YoY spending change.

#---------------------------
  
# T-test #2) Pre-Obama Public Low-Carbon RD&D Spending (1985-2008): U.S. vs Germany 

         #Alternative hypothesis == Prior to Obama's inauguration (in the period spanning 1985-2008), the mean YoY change in public low-carbon RDD spending in the United States is not statistically distinct from Germany's mean YoY change in public spending   
    
          ##^ this hypothesis would mean that our null hypothesis is: prior to obama admin, the mean YoY change in public low-carbon RDD spending in the United States IS statistically distinct from germany  

Pre.2009.US.Germany.RDD <- filter(US.and.Germany.RDD, Year %in% c(1985:2008))
  
Pre.2009.US.Germany.ttest <- t.test(Pre.2009.US.Germany.RDD$Percent.Change ~ 
                                      Pre.2009.US.Germany.RDD$Country)

Pre.2009.US.Germany.ttest
    
      #The p-value is 0.5113 which is greater than 0.05 so we must accept our null hypothesis. Therefore, in the period prior to Obama's presidency (1985-2008), the mean year-over-year change in public low-carbon RD&D spending in the U.S. was statistically distinct from Germany.
    
      #NOTES FROM GOOGLE RE: NULL: If the p-value is below your threshold of significance (typically p < 0.05), then you can reject the null hypothesis, but this does not necessarily mean that your alternative hypothesis is true.

#------------------------------
  
# T-test #3) Obama-era Public Low-carbon RD&D Spending (2009-2015): United States vs. Germany

            ##Alternative Hypothesis == during the Obama presidency (2009-2015), the mean YoY change in public low-carbon RDD spending in the United States was statistically distinct from the mean YoY change in Germany 

Post.2009.US.Germany.RDD <- filter(US.and.Germany.RDD, Year %in% c(2009:2015))
  
Post.2009.US.Germany.ttest <- t.test(Post.2009.US.Germany.RDD$Percent.Change ~ 
                                      Post.2009.US.Germany.RDD$Country)

Post.2009.US.Germany.ttest
  
          #The p-value is 0.857 which is greater than 0.05 so the null hypothesis is accepted. Therefore, Obama-era (2009-2015) mean year-over-year change in public low-carbon RD&D spending in the U.S. was not statistically distinct from Germany.

```

\newpage

# Summary and Conclusions

\newpage

#Scripts, data and code
The repository linked at the beginning contains both the raw data, wrangled data, and code utilized. They are found in their respective folders.

#Quality assurance 
Please note that any conclusions created by this report are limited as only one source of data and one variable were utilized. Further examination of additional metrics and countries are recommended for future analyses.  

# References

\<add references here if relevant, otherwise delete this section\>
